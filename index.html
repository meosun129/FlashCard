<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>플래시 카드</title>
    <style>
        body {
            font-family: Arial, "맑은 고딕", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f5f5f5;
        }

        .container {
            text-align: center;
        }

        .card {
            width: 400px;
            min-height: 200px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .card-text {
            font-size: 22px;
            line-height: 1.4;
            white-space: pre-line; /* 줄바꿈 허용 */
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        button {
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .primary {
            background: #007bff;
            color: white;
        }

        .secondary {
            background: #e0e0e0;
        }

        .info {
            margin-top: 5px;
            font-size: 13px;
            color: #666;
        }

        .timer {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="timerText" class="timer"></div>

    <div id="card" class="card">
        <div id="cardText" class="card-text"></div>
    </div>

    <div class="buttons">
        <button id="prevBtn" class="secondary">◀ 이전 카드</button>
        <button id="toggleBtn" class="secondary">정답 보기</button>
        <button id="nextBtn" class="secondary">다음 카드 ▶</button>
    </div>

    <div class="buttons">
        <button id="timer30Btn" class="primary">30초 후 정답 보기</button>
        <button id="timer60Btn" class="primary">60초 후 정답 보기</button>
    </div>

    <div class="info" id="infoText"></div>
</div>

<script>
    // 1. 플래시 카드 데이터 (JSON에서 로드할 예정)
    let cards = [];
    let currentIndex = 0;
    let showingAnswer = false;

    // 타이머 관련
    let countdown = 0;
    let countdownId = null;

    const cardTextEl = document.getElementById("cardText");
    const toggleBtn = document.getElementById("toggleBtn");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");
    const infoTextEl = document.getElementById("infoText");
    const cardEl = document.getElementById("card");

    const timerTextEl = document.getElementById("timerText");
    const timer30Btn = document.getElementById("timer30Btn");
    const timer60Btn = document.getElementById("timer60Btn");

    // JSON 파일에서 카드 데이터 로드
    async function loadCards() {
        try {
            const res = await fetch("cards.json");
            cards = await res.json();
        } catch (err) {
            console.error(err);
            cards = [];
        }
        updateCard();
    }

    function updateCard() {
        if (cards.length === 0) {
            cardTextEl.textContent = "카드가 없습니다. cards.json을 확인하세요.";
            infoTextEl.textContent = "";
            return;
        }

        const card = cards[currentIndex];

        if (showingAnswer) {
            cardTextEl.textContent = "A. " + card.answer;
            toggleBtn.textContent = "문제 보기";
        } else {
            cardTextEl.textContent = "Q. " + card.question;
            toggleBtn.textContent = "정답 보기";
        }

        infoTextEl.textContent = `카드 ${currentIndex + 1} / ${cards.length}`;
    }

    function toggleCard() {
        showingAnswer = !showingAnswer;
        stopTimer(); // 수동으로 뒤집으면 타이머는 멈춤
        updateCard();
    }

    function nextCard() {
        if (cards.length === 0) return;
        currentIndex = (currentIndex + 1) % cards.length;
        showingAnswer = false;
        stopTimer();
        updateCard();
    }

    function prevCard() {
        if (cards.length === 0) return;
        currentIndex = (currentIndex - 1 + cards.length) % cards.length;
        showingAnswer = false;
        stopTimer();
        updateCard();
    }

    function startTimer(seconds) {
        if (cards.length === 0) return;

        // 기존 타이머 정리
        stopTimer();

        countdown = seconds;
        timerTextEl.textContent = `남은 시간: ${countdown}초`;

        countdownId = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                timerTextEl.textContent = `남은 시간: ${countdown}초`;
            } else {
                // 시간 끝!
                clearInterval(countdownId);
                countdownId = null;
                timerTextEl.textContent = "시간 종료! 정답이 공개되었습니다.";
                showingAnswer = true;       // == 카드 뒷장 보이게
                updateCard();
            }
        }, 1000);
    }

    function stopTimer() {
        if (countdownId !== null) {
            clearInterval(countdownId);
            countdownId = null;
        }
        timerTextEl.textContent = "";
    }

    // 이벤트 연결
    cardEl.addEventListener("click", toggleCard);
    toggleBtn.addEventListener("click", toggleCard);
    nextBtn.addEventListener("click", nextCard);
    prevBtn.addEventListener("click", prevCard);

    timer30Btn.addEventListener("click", () => startTimer(30));
    timer60Btn.addEventListener("click", () => startTimer(60));

    // 페이지가 로드되면 JSON에서 카드 불러오기
    loadCards();
</script>
</body>
</html>
